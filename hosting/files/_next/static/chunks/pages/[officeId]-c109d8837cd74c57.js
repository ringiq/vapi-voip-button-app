(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{1518:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[officeId]",function(){return a(3722)}])},3722:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var o,n,s,l,r,i,c,d,u=a(5893),f=a(2121),v=a.n(f),p=a(1163),g=a(7294),h=a(2386);(o=r||(r={})).TRANSCRIPT="transcript",o.FUNCTION_CALL="function-call",o.FUNCTION_CALL_RESULT="function-call-result",o.ADD_MESSAGE="add-message",(n=i||(i={})).USER="user",n.SYSTEM="system",n.ASSISTANT="assistant",(s=c||(c={})).PARTIAL="partial",s.FINAL="final",(l=d||(d={})).INACTIVE="inactive",l.ACTIVE="active",l.LOADING="loading";var x=a(3225),b=a(5197),m=a(9245),k=a(1465),S=a(5139),N=a(512),A=a(8388);let y=(0,S.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-slate-950 dark:focus-visible:ring-slate-300",{variants:{variant:{default:"bg-slate-900 text-slate-50 hover:bg-slate-900/90 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-50/90",destructive:"bg-red-500 text-slate-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-slate-50 dark:hover:bg-red-900/90",outline:"border border-slate-200 bg-white hover:bg-slate-100 hover:text-slate-900 dark:border-slate-800 dark:bg-slate-950 dark:hover:bg-slate-800 dark:hover:text-slate-50",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-100/80 dark:bg-slate-800 dark:text-slate-50 dark:hover:bg-slate-800/80",ghost:"hover:bg-slate-100 hover:text-slate-900 dark:hover:bg-slate-800 dark:hover:text-slate-50",link:"text-slate-900 underline-offset-4 hover:underline dark:text-slate-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),C=g.forwardRef((e,t)=>{let{className:a,variant:o,size:n,asChild:s=!1,...l}=e,r=s?k.g7:"button";return(0,u.jsx)(r,{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,A.m6)((0,N.W)(t))}(y({variant:o,size:n,className:a})),ref:t,...l})});C.displayName="Button";let E=e=>{let{toggleCall:t,callStatus:a,audioLevel:o=0}=e,[n,s]=(0,g.useState)(!1),l=a===d.ACTIVE?"#C27F54":a===d.LOADING?"#E16269":"#536FA6",r={width:"4em",height:"4em",color:l,opacity:.75},i={borderRadius:"50%",width:"12em",height:"12em",color:"white",border:"none",boxShadow:"1px 1px ".concat(10+40*o,"px ").concat(10*o,"px ").concat(l,", 0px 0px 26px 4px ").concat(l," inset"),backgroundColor:"transparent",cursor:"pointer"},c={boxShadow:"1px 1px ".concat(10+40*o,"px ").concat(10*o,"px ").concat(l,", 0px 0px 52px 8px ").concat(l," inset")};return(0,u.jsx)(C,{onMouseEnter:()=>{s(!0)},onMouseLeave:()=>{s(!1)},style:{...i,...n&&c},className:"transition ease-in-out flex items-center justify-center",onClick:t,children:a===d.ACTIVE?(0,u.jsx)(x.Z,{style:r}):a===d.LOADING?(0,u.jsx)(b.Z,{style:r,className:"animate-spin"}):(0,u.jsx)(m.Z,{style:r})})};function I(e){var t,a,o,n;let{error:s,loading:l,office:i,vapi:d}=e;if(s||l||!i||!i.vapiVoip||!(null===(t=i.vapiVoip)||void 0===t?void 0:t.token)||!(null===(a=i.vapiVoip)||void 0===a?void 0:a.assistantId))return;null===(o=i.vapiVoip)||void 0===o||o.token;let{toggleCall:f,callStatus:v,audioLevel:p}=function(e){let{vapi:t,assistantId:a}=e,[o,n]=(0,g.useState)(!1),[s,l]=(0,g.useState)("inactive"),[i,d]=(0,g.useState)([]),[u,f]=(0,g.useState)(null),[v,p]=(0,g.useState)(0);(0,g.useEffect)(()=>{let e=()=>n(!0),a=()=>{console.log("Speech has ended"),n(!1)},o=()=>{console.log("Call has started"),l("active")},s=()=>{console.log("Call has stopped"),l("inactive")},i=e=>{p(e)},u=e=>{console.log("message",e),e.type===r.TRANSCRIPT&&e.transcriptType===c.PARTIAL?f(e):(d(t=>[...t,e]),f(null))},v=e=>{l("inactive"),console.error(e)};return t.on("speech-start",e),t.on("speech-end",a),t.on("call-start",o),t.on("call-end",s),t.on("volume-level",i),t.on("message",u),t.on("error",v),()=>{t.off("speech-start",e),t.off("speech-end",a),t.off("call-start",o),t.off("call-end",s),t.off("volume-level",i),t.off("message",u),t.off("error",v)}},[]);let h=async()=>{l("loading"),console.log("before start"),t.start(a).then(e=>{console.log("call",e)})},x=()=>{l("loading"),t.stop()};return{isSpeechActive:o,callStatus:s,audioLevel:v,activeTranscript:u,messages:i,start:h,stop:x,toggleCall:()=>{"active"==s?x():h()}}}({vapi:d||{},assistantId:(null===(n=i.vapiVoip)||void 0===n?void 0:n.assistantId)||""});return(0,u.jsx)(E,{audioLevel:p,callStatus:v,toggleCall:f})}var w=a(5349),T=a.n(w),_=()=>{let{realmApp:e,user:t,loading:a}=(0,h.P)(),{officeId:o}=(0,p.useRouter)().query,[n,s]=(0,g.useState)(null),[l,r]=(0,g.useState)(null),[i,c]=(0,g.useState)(!0),[d,f]=(0,g.useState)(null);return((0,g.useEffect)(()=>{e&&t&&o&&!a&&(console.log(t),(async()=>{try{var t,a;let n=(null===(t=e.currentUser)||void 0===t?void 0:t.mongoClient("mongodb-atlas")).db("ringiq").collection("offices"),l=await n.findOne({_id:o});if(l){let e=new(T())(null===(a=l.vapiVoip)||void 0===a?void 0:a.token);r(l),s(e)}else console.error("Office not found")}catch(e){console.error("Error fetching office:",e)}finally{c(!1)}})())},[e,t,o,a]),i)?(0,u.jsx)("div",{children:"Loading..."}):d?(0,u.jsxs)("div",{children:["Error: ",d]}):l?(0,u.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-12 ".concat(v().className),children:(0,u.jsx)(I,{error:d,loading:i,office:l,vapi:n})}):(0,u.jsx)("div",{children:"No office found"})}}},function(e){e.O(0,[789,42,888,774,179],function(){return e(e.s=1518)}),_N_E=e.O()}]);